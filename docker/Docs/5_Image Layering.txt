1010, 1011

목록:
    - 이미지 계층화 (Image Layering)
    - 레이어 캐싱 (Layer Caching)


이미지 계층화 (Image Layering)

 -커맨드: docker image history <image-name>
 이미지 내의 각 레이어를 만드는 데 사용된 커맨드를 표시.

 -커맨드: docker image history --no-truc <image-name>
 전체 OUTPUT.


# Layer caching
 목적:
    - 계층화에서 컨테이너 이미지 빌드 시간을 줄이기 위한 것.

 정리:
    - 레이어가 변경되면, 모든 다운스트림 레이어도 재생성.
    - 이미지를 빌드하면, '도커 파일'에서 각 커맨드는 새로운 레이어가 됨.
    - 그러나 이미지를 변경할 때마다 종속성을 재생성하는 것은 말이 안되므로, '도커 파일'이 종속성 캐싱을 지원하도록 재구성.
    -과정:
        - '.dockerignore' 파일을 사용해서 이미지 관련 파일만 복사할 수 있도록함. 
        - 그 다음, 종속성이 정의된 혹은 관련 파일만 복사하고, 종속성 설치. / 그 다음에 다른 모든 파일을 복사.
    - 종속성 정의된 혹은 관련 파일이 변경될 때만 종속성을 재생성하게 됌.
    - 이에 관한 내용은 빌드 과정에서 더 자세히 볼 수 있음.
    - 변경된 파일에 해당하는 레이어와 그 다운스트림 레이어들을 제외하고, `Using cache`를 출력함. '빌드 캐시'를 사용하는 것임.
    -결과: 
        - 더 빠른 푸싱, 풀링, 업데이트가 가능해짐.

 용어: 
    *다운스트림 레이어
    *.dockerignore
    *빌드 캐시


# Multi-stage builds
 목적:
    - 여러 단계로 빌드하면 런타임 종속성으로부터 빌드 타임 종속성을 분리할 수 있고, 앱 실행에 필요한 항목만 전송하여 전체 이미지 크기를 줄일 수 있음.


 

